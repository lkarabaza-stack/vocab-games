<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Pairs</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg:           var(--tg-theme-bg-color, #f0f4ff);
            --text:         var(--tg-theme-text-color, #111827);
            --card-bg:      var(--tg-theme-secondary-bg-color, #ffffff);
            --primary:      var(--tg-theme-button-color, #3b82f6);
            --primary-dark: #2563eb;
            --success:      #10b981;
            --error:        #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        /* â”€â”€ LEVEL SELECT SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #level-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            min-height: 80vh;
            width: 100%;
            max-width: 380px;
            animation: fadeUp 0.4s ease both;
        }

        #level-screen h1 {
            font-size: 2rem;
            text-align: center;
        }

        #level-screen p {
            font-size: 1rem;
            opacity: 0.6;
            text-align: center;
        }

        .level-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        .btn-level {
            width: 100%;
            padding: 18px 20px;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.12s, box-shadow 0.12s;
        }

        .btn-level:active { transform: scale(0.97); }

        .btn-level.lv1 {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: #fff;
            box-shadow: 0 6px 18px rgba(99,102,241,0.35);
        }
        .btn-level.lv2 {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: #fff;
            box-shadow: 0 6px 18px rgba(139,92,246,0.35);
        }
        .btn-level.lv3 {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            color: #fff;
            box-shadow: 0 6px 18px rgba(245,158,11,0.35);
        }

        .btn-level .lv-name { font-size: 1.1rem; }
        .btn-level .lv-desc { font-size: 0.8rem; opacity: 0.85; font-weight: 500; }

        /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            display: none;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 440px;
            margin-bottom: 12px;
            padding: 10px 16px;
            background: var(--card-bg);
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            font-size: 1.05rem;
            font-weight: 700;
        }

        .header.visible { display: flex; }

        /* â”€â”€ GRID: 2 ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .grid {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
            max-width: 440px;
        }

        .grid.visible { display: grid; }

        /* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            width: 100%;
            min-height: 60px;
            padding: 12px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 12px;
            font-size: 1.05rem;       /* â† ĞºÑ€ÑƒĞ¿Ğ½ĞµĞµ */
            font-weight: 600;
            line-height: 1.3;
            word-break: break-word;
            hyphens: auto;
            cursor: pointer;
            border: 2px solid var(--primary);
            background: var(--card-bg);
            color: var(--text);
            box-shadow: 0 2px 6px rgba(0,0,0,0.07);
            transition: background 0.18s, border-color 0.18s,
                        color 0.18s, transform 0.13s, box-shadow 0.18s;
        }

        /* Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ â€” Ñ‡ÑƒÑ‚ÑŒ Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ ÑˆÑ€Ğ¸Ñ„Ñ‚Ğ° Ğ´Ğ»Ñ 8 Ğ¿Ğ°Ñ€ */
        .grid.lv3 .card { font-size: 0.92rem; min-height: 52px; }

        .card:active:not(.matched):not(.dealing) { transform: scale(0.95); }

        .card.selected {
            border-color: var(--primary-dark);
            background: color-mix(in srgb, var(--primary) 14%, var(--card-bg));
            box-shadow: 0 0 0 3px rgba(59,130,246,0.25);
            transform: scale(1.04);
        }

        .card.matched {
            background: var(--success);
            border-color: var(--success);
            color: #fff;
            box-shadow: 0 4px 12px rgba(16,185,129,0.35);
            cursor: default;
            animation: pop 0.32s cubic-bezier(0.34,1.56,0.64,1);
        }

        @keyframes pop {
            0%   { transform: scale(1); }
            50%  { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .card.wrong {
            background: var(--error);
            border-color: var(--error);
            color: #fff;
            animation: shake 0.38s ease;
        }

        @keyframes shake {
            0%,100% { transform: translateX(0); }
            20%     { transform: translateX(-6px); }
            60%     { transform: translateX(6px); }
            80%     { transform: translateX(-3px); }
        }

        @keyframes dealIn {
            0%   { opacity: 0; transform: translateY(-28px) scale(0.82) rotate(var(--r)); }
            65%  { transform: translateY(5px) scale(1.05) rotate(0deg); }
            100% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
        }

        .card.dealing { animation: dealIn 0.42s cubic-bezier(0.22,1,0.36,1) both; }

        /* â”€â”€ WIN SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #win-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-top: 50px;
            animation: fadeUp 0.5s ease both;
            text-align: center;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(24px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        #win-screen h1 { font-size: 2.4rem; }
        #win-screen p  { font-size: 1.05rem; opacity: 0.75; }

        /* Ğ‘ĞµĞ¹Ğ´Ğ¶ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ */
        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            color: #fff;
        }

        .level-badge.lv1 { background: linear-gradient(135deg,#3b82f6,#6366f1); }
        .level-badge.lv2 { background: linear-gradient(135deg,#8b5cf6,#ec4899); }
        .level-badge.lv3 { background: linear-gradient(135deg,#f59e0b,#ef4444); }

        .win-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 300px;
        }

        .btn {
            padding: 14px 20px;
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 14px rgba(59,130,246,0.38);
            transition: background 0.18s, transform 0.1s;
        }
        .btn:active { transform: scale(0.95); background: var(--primary-dark); }

        .btn-outline {
            padding: 12px 20px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.18s, transform 0.1s;
        }
        .btn-outline:active { transform: scale(0.95); background: color-mix(in srgb, var(--primary) 8%, transparent); }

        /* â”€â”€ ERROR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #error-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 60px;
            color: var(--error);
            font-size: 1rem;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ -->
    <div id="level-screen">
        <div>
            <h1>ğŸ§  Match Pairs</h1>
            <p style="margin-top:8px">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸</p>
        </div>
        <div class="level-buttons">
            <button class="btn-level lv1" data-pairs="4">
                <span class="lv-name">â­ Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹</span>
                <span class="lv-desc">4 Ğ¿Ğ°Ñ€Ñ‹</span>
            </button>
            <button class="btn-level lv2" data-pairs="6">
                <span class="lv-name">â­â­ Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹</span>
                <span class="lv-desc">6 Ğ¿Ğ°Ñ€</span>
            </button>
            <button class="btn-level lv3" data-pairs="8">
                <span class="lv-name">â­â­â­ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹</span>
                <span class="lv-desc">8 Ğ¿Ğ°Ñ€</span>
            </button>
        </div>
    </div>

    <!-- Ğ˜Ğ³Ñ€Ğ° -->
    <div class="header" id="header">
        <div id="timer">â± 00:00</div>
        <div id="level-label"></div>
        <div id="score">ĞŸĞ°Ñ€Ñ‹: 0 / â€”</div>
    </div>

    <div class="grid" id="grid"></div>

    <!-- ĞŸĞ¾Ğ±ĞµĞ´Ğ° -->
    <div id="win-screen">
        <h1>ğŸ‰ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!</h1>
        <div id="win-badge" class="level-badge"></div>
        <p id="final-stats"></p>
        <div class="win-buttons">
            <button class="btn"         id="btn-restart">Ğ¡Ñ‹Ğ³Ñ€Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ° (Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ)</button>
            <button class="btn-outline" id="btn-change-level">Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ</button>
        </div>
    </div>

    <div id="error-screen">
        <p>âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ³Ñ€Ñ‹.<br>ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾.</p>
    </div>

    <script>
        /* â”€â”€ Telegram SDK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const tg = window.Telegram?.WebApp;
        if (tg) tg.expand();

        /* â”€â”€ Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ³Ñ€Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const urlParams = new URLSearchParams(window.location.search);
        let allData = [];

        try {
            const raw = urlParams.get('data');
            if (raw) {
                allData = JSON.parse(decodeURIComponent(raw));
                if (!Array.isArray(allData) || !allData.length) throw new Error('empty');
            } else {
                // Ğ”ĞµĞ¼Ğ¾ â€” Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 8 ÑĞ»Ğ¾Ğ²
                allData = [
                    { w: 'Hund',       t: 'Ğ¡Ğ¾Ğ±Ğ°ĞºĞ°'    },
                    { w: 'Katze',      t: 'ĞšĞ¾ÑˆĞºĞ°'     },
                    { w: 'Haus',       t: 'Ğ”Ğ¾Ğ¼'       },
                    { w: 'Auto',       t: 'ĞœĞ°ÑˆĞ¸Ğ½Ğ°'    },
                    { w: 'Baum',       t: 'Ğ”ĞµÑ€ĞµĞ²Ğ¾'    },
                    { w: 'Apfel',      t: 'Ğ¯Ğ±Ğ»Ğ¾ĞºĞ¾'    },
                    { w: 'Wasser',     t: 'Ğ’Ğ¾Ğ´Ğ°'      },
                    { w: 'Brot',       t: 'Ğ¥Ğ»ĞµĞ±'      },
                    { w: 'Schule',     t: 'Ğ¨ĞºĞ¾Ğ»Ğ°'     },
                    { w: 'Buch',       t: 'ĞšĞ½Ğ¸Ğ³Ğ°'     },
                    { w: 'Kind',       t: 'Ğ ĞµĞ±Ñ‘Ğ½Ğ¾Ğº'   },
                    { w: 'Freund',     t: 'Ğ”Ñ€ÑƒĞ³'      },
                ];
            }
        } catch (e) {
            console.error('Data error:', e);
            document.getElementById('level-screen').style.display  = 'none';
            document.getElementById('error-screen').style.display  = 'flex';
        }

        /* â”€â”€ Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        let currentPairs   = 4;
        let gameData       = [];       // Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ ÑĞ»Ğ¾Ğ² (ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ N Ğ¸Ğ· allData)
        let timerInterval  = null;
        let secondsElapsed = 0;
        let timerStarted   = false;
        let matchedPairs   = 0;
        let attempts       = 0;
        let selectedCard   = null;
        let lockBoard      = false;

        /* â”€â”€ DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const grid         = document.getElementById('grid');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const levelLabel   = document.getElementById('level-label');

        /* â”€â”€ Fisher-Yates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function shuffle(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        /* â”€â”€ Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ N ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ğ² Ğ¸Ğ· allData â”€â”€â”€â”€â”€â”€â”€â”€ */
        function pickWords(n) {
            const available = allData.length;
            const count = Math.min(n, available);
            return shuffle(allData).slice(0, count);
        }

        /* â”€â”€ Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        document.querySelectorAll('.btn-level').forEach(btn => {
            btn.addEventListener('click', () => {
                currentPairs = parseInt(btn.dataset.pairs);
                startGame();
            });
        });

        function levelInfo(n) {
            if (n <= 4) return { cls: 'lv1', label: 'â­ Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹', gridCls: '' };
            if (n <= 6) return { cls: 'lv2', label: 'â­â­ Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹', gridCls: '' };
            return           { cls: 'lv3', label: 'â­â­â­ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹', gridCls: 'lv3' };
        }

        /* â”€â”€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ³Ñ€Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function startGame() {
            // Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
            clearInterval(timerInterval);
            secondsElapsed = 0; timerStarted = false;
            matchedPairs   = 0; attempts     = 0;
            selectedCard   = null; lockBoard  = false;

            // Ğ’Ğ·ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°
            gameData = pickWords(currentPairs);

            const info = levelInfo(currentPairs);

            // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ, ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ
            document.getElementById('level-screen').style.display = 'none';
            document.getElementById('win-screen').style.display   = 'none';
            document.getElementById('header').classList.add('visible');
            grid.classList.remove('hidden');
            grid.className = 'grid visible' + (info.gridCls ? ' ' + info.gridCls : '');

            timerDisplay.textContent  = 'â± 00:00';
            scoreDisplay.textContent  = `ĞŸĞ°Ñ€Ñ‹: 0 / ${currentPairs}`;
            levelLabel.textContent    = info.label;

            buildCards();
        }

        /* â”€â”€ Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function startTimer() {
            if (timerStarted) return;
            timerStarted = true;
            timerInterval = setInterval(() => {
                secondsElapsed++;
                timerDisplay.textContent = `â± ${fmt(secondsElapsed)}`;
            }, 1000);
        }

        function fmt(sec) {
            return `${String(Math.floor(sec / 60)).padStart(2,'0')}:${String(sec % 60).padStart(2,'0')}`;
        }

        /* â”€â”€ ĞŸĞ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function buildCards() {
            grid.innerHTML = '';
            lockBoard = true;

            const leftCol  = shuffle(gameData.map((p, i) => ({ id: i, text: p.w })));
            const rightCol = shuffle(gameData.map((p, i) => ({ id: i, text: p.t })));

            for (let i = 0; i < gameData.length; i++) {
                [leftCol[i], rightCol[i]].forEach((item, side) => {
                    const card = document.createElement('div');
                    card.classList.add('card', 'dealing');
                    card.dataset.id = item.id;

                    const rot = ((Math.random() * 10) - 5).toFixed(1);
                    card.style.setProperty('--r', rot + 'deg');
                    card.style.animationDelay = (i * 2 + side) * 40 + 'ms';

                    card.textContent = item.text;
                    card.addEventListener('click', onCardClick);
                    grid.appendChild(card);
                });
            }

            const totalMs = (gameData.length * 2 - 1) * 40 + 420;
            setTimeout(() => {
                lockBoard = false;
                grid.querySelectorAll('.card').forEach(c => c.classList.remove('dealing'));
            }, totalMs);
        }

        /* â”€â”€ ĞšĞ»Ğ¸Ğº Ğ¿Ğ¾ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function onCardClick() {
            if (lockBoard || this.classList.contains('matched')) return;
            startTimer();

            if (this === selectedCard) {
                this.classList.remove('selected');
                selectedCard = null;
                return;
            }

            if (!selectedCard) {
                this.classList.add('selected');
                selectedCard = this;
                return;
            }

            const first  = selectedCard;
            const second = this;
            first.classList.remove('selected');
            selectedCard = null;
            attempts++;

            if (first.dataset.id === second.dataset.id) {
                first.classList.add('matched');
                second.classList.add('matched');
                first.removeEventListener('click', onCardClick);
                second.removeEventListener('click', onCardClick);
                matchedPairs++;
                scoreDisplay.textContent = `ĞŸĞ°Ñ€Ñ‹: ${matchedPairs} / ${currentPairs}`;
                if (tg) tg.HapticFeedback?.impactOccurred('light');
                if (matchedPairs === currentPairs) setTimeout(winGame, 450);
            } else {
                lockBoard = true;
                first.classList.add('wrong');
                second.classList.add('wrong');
                if (tg) tg.HapticFeedback?.notificationOccurred('error');
                setTimeout(() => {
                    first.classList.remove('wrong');
                    second.classList.remove('wrong');
                    lockBoard = false;
                }, 700);
            }
        }

        /* â”€â”€ ĞŸĞ¾Ğ±ĞµĞ´Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function winGame() {
            clearInterval(timerInterval);
            grid.className = 'grid';
            document.getElementById('header').classList.remove('visible');

            const acc  = attempts > 0 ? Math.round((currentPairs / attempts) * 100) : 100;
            const info = levelInfo(currentPairs);

            const badge = document.getElementById('win-badge');
            badge.textContent  = info.label;
            badge.className    = `level-badge ${info.cls}`;

            document.getElementById('final-stats').textContent =
                `Ğ’Ñ€ĞµĞ¼Ñ: ${fmt(secondsElapsed)} Â· Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ: ${acc}%`;
            document.getElementById('win-screen').style.display = 'flex';

            if (tg) tg.HapticFeedback?.notificationOccurred('success');
            setTimeout(() => {
                if (tg) tg.sendData(JSON.stringify({
                    game: 'match_pairs', level: currentPairs,
                    time_seconds: secondsElapsed, attempts, accuracy: acc
                }));
            }, 2000);
        }

        /* â”€â”€ Ğ¡Ñ‹Ğ³Ñ€Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ° (Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°, Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ) */
        document.getElementById('btn-restart').addEventListener('click', () => {
            startGame();  // pickWords Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ â€” Ğ²ÑĞµĞ³Ğ´Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğµ
        });

        /* â”€â”€ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        document.getElementById('btn-change-level').addEventListener('click', () => {
            document.getElementById('win-screen').style.display    = 'none';
            document.getElementById('level-screen').style.display  = 'flex';
        });
    </script>
</body>
</html>
